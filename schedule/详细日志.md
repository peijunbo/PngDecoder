# 9月22日

简单了解png格式

[PNG文件结构分析 ---Png解析_fifbro的博客-CSDN博客_png解析](https://blog.csdn.net/qq_21950929/article/details/79198814)

#### 今日分析：

1. 应该要先设法读取出文件内容来进行处理。
2. 理解各个数据块的大小格式等
3. 要学习使用zlib(题中有写)

# 9月23日

#### 行动:

1. 复习python的文件操作，意识到应该以二进制读取
2. 尝试用代码1简单读取，发现输出看不懂

```python
#代码1
picture = open("C:\\Users\裴俊博\Desktop\实习题-实现png解码器\后端组实习题PngDecoder\\task1\\test1.png", mode = "rb")
context = picture.read(100)
print(context)
picture.close()
#输出
b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x03\xfb\x00\x00\x02{\x08\x02\x00\x00\x003\xdd\x16\x01\x00\x00\x00\x01sRGB\x00\xae\xce\x1c\xe9\x00\x00\x00\x04gAMA\x00\x00\xb1\x8f\x0b\xfc
```

3. 网上查阅资料了解到struct库处理二进制，然而`unpack()`函数的返回值搞不懂。对比winhex显示的数据，发现前边的数字一样，字母的ascii码和winhex中的数字对应。用`type()`函数发现为bytes格式(第一次了解到这个格式)

4. 尝试转化为16进制(毕竟和winhex显示的一样)-------失败。

5. 上网学习pythonbytes类型转换及进制转换。[Python进制转换详细介绍_Wonderful-CSDN博客_python进制转换](https://blog.csdn.net/weixin_43353539/article/details/89444838)。[Python 十六进制hex-bytes-str之间的转换和Bcc码的生成 - wen-cheng - 博客园 (cnblogs.com)](https://www.cnblogs.com/wen-cheng/p/13236341.html)

6. 写出代码并进行输出

   ```py
   #输出样例
   0x890x500x4e0x470xd0xa0x1a0xa0x00x00x00xd0x490x480x440x520x00x00x30xfb0x00x00x20x7b0x8
   ```


7. 创建列表准备进行处理

8. 学习将数字与ascii进行转换。利用`chr()`函数将数字转换为ascii对应字符

9. 码代码

10. ```py
    import struct
    
    
    #图片地址
    Paddress1 = "C:\\Users\裴俊博\Desktop\实习题-实现png解码器\后端组实习题PngDecoder\\task1\\test1.png"
    Paddress2 = "C:\\Users\裴俊博\Desktop\实习题-实现png解码器\后端组实习题PngDecoder\\task1\\test2.png"
    
    #输出的文件地址
    txtaddress1 = "..\\docs\\test1.txt"
    txtaddress2 = "..\\docs\\test2.txt"
    
    picture1 = open(Paddress1, mode = "rb")
    picture2 = open(Paddress2, mode = "rb")
    
    context1 = picture1.read()
    context1 = struct.unpack(str(len(context1)) + "c", context1)
    context2 = picture2.read()
    context2 = struct.unpack(str(len(context2)) + "c", context2)
    #建一个记录的列表
    intlist1 = []
    hexlist1 = []
    intlist2 = []
    hexlist2 = []
    for i in context1:
        a = i.hex()
        a = int(a,16)
        intlist1.append(a)
        a = hex(int(a))
        hexlist1.append(a)
    
    for i in context2:
        a = i.hex()
        a = int(a,16)
        intlist2.append(a)
        a = hex(int(a))
        hexlist2.append(a)
    
    #创建数据块类每个类变量内有该数据块的信息
    class chunk:
        def __init__(self, index, list):
            self.Length = list[index]*(16**6) + list[index+1]*(16**4) + list[index + 2]*(16**2) + list[index + 3]
            index += 4
            self.Type = chr(list[index]) + chr(list[index+1]) + chr(list[index+2]) + chr(list[index+3])
            index += 4
    
            #目前还不处理数据因此跳过数据块数据
    
            index += self.Length
            #CRC
            self.CRC = [list[index], list[index+1], list[index+2], list[index+3]]
            self.endindex = index + 4
    #将所有数据块读取存入列表中
    initindex = 8
    
    def setchunk(index, list):
        outlist = []
        while index < len(list):
            ck = chunk(index, list)
            outlist.append(ck)
            index = ck.endindex
        return outlist
    #打印数据块
    chunklist1 = setchunk(initindex, intlist1)
    chunklist2 = setchunk(initindex, intlist2)
    
    
    #将结果写入文件中
    shuchu1 = open(txtaddress1,"w")
    shuchu1.write("Length")
    shuchu1.write("\t")
    shuchu1.write("Type")
    shuchu1.write("\t")
    shuchu1.write("CRC")
    shuchu1.write("\n")
    
    for i in chunklist1:
        shuchu1.write(str(i.Length))
        shuchu1.write("\t")
        shuchu1.write(str(i.Type))
        shuchu1.write("\t")
        shuchu1.write(str(i.CRC))
        shuchu1.write("\n")
    
    shuchu2 = open(txtaddress2, "w")
    shuchu2.write("Length")
    shuchu2.write("\t")
    shuchu2.write("Type")
    shuchu2.write("\t")
    shuchu2.write("CRC")
    shuchu2.write("\n")
    
    for i in chunklist2:
        shuchu2.write(str(i.Length))
        shuchu2.write("\t")
        shuchu2.write(str(i.Type))
        shuchu2.write("\t")
        shuchu2.write(str(i.CRC))
        shuchu2.write("\n")
    
    
    picture1.close()
    picture2.close()
    ```
    
11. task1完成